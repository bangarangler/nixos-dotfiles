# ==========================================
# Tmux Configuration for NixOS + Wayland
# ==========================================

# ------------------------------
# Terminal & Colors
# ------------------------------
set-option default-terminal "tmux-256color"
set-option -a terminal-overrides ",*256col*:RGB"
set-option -a terminal-overrides ",ghostty:RGB"
set-option -a terminal-overrides ",alacritty:RGB"

# ------------------------------
# Prefix Key
# ------------------------------
set-option -g prefix C-a
unbind-key C-a
bind-key C-a send-prefix

# ------------------------------
# General Settings
# ------------------------------
set -g base-index 1
set -g mouse on
setw -g mode-keys vi
set-option -sg escape-time 10
set-option -g repeat-time 0

# Easy config reload
bind-key R source-file ~/.tmux.conf \; display-message "tmux.conf reloaded."

# ------------------------------
# Navigation
# ------------------------------
bind-key : command-prompt
bind-key r refresh-client
bind-key L clear-history

bind-key space next-window
bind-key bspace previous-window
bind-key enter next-layout

# Vim-like splits
bind-key v split-window -h -c "#{pane_current_path}"
bind-key s split-window -v -c "#{pane_current_path}"
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

bind-key C-o rotate-window

bind-key + select-layout main-horizontal
bind-key = select-layout main-vertical
set-window-option -g other-pane-height 25
set-window-option -g other-pane-width 80

bind-key a last-pane
bind-key q display-panes
bind-key c new-window
bind-key t next-window
bind-key T previous-window

# ------------------------------
# Copy Mode (Wayland - wl-clipboard)
# ------------------------------
bind-key [ copy-mode
bind-key ] paste-buffer

# Vi-style copy with wl-copy (Wayland clipboard)
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "wl-copy"
unbind -T copy-mode-vi Enter
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "wl-copy"

# Mouse scroll in copy mode
bind-key -T root WheelUpPane if-shell -F -t = "#{alternate_on}" "send-keys -M" "select-pane -t =; copy-mode -e; send-keys -M"
bind-key -T root WheelDownPane if-shell -F -t = "#{alternate_on}" "send-keys -M" "select-pane -t =; send-keys -M"

# ------------------------------
# Status Bar (Dracula Theme)
# ------------------------------
set-window-option -g display-panes-time 1500
set-option -g status-interval 1
set-option -g status-left ''
set-option -g status-right '%l:%M%p'
set-option -g status-fg default

# Dracula Colors
# background_color '#282a36'
# current_line_color '#44475a'
# foreground_color '#f8f8f2'
# comment_color '#6272a4'
# cyan '#8be9fd'
# green '#50fa7b'
# orange '#ffb86c'
# pink '#ff79c6'
# purple '#bd93f9'
# red '#ff5555'
# yellow '#f1fa8c'

# Pane border
set -g pane-border-style fg='#6272a4'
set -g pane-active-border-style fg='#ff79c6'

# Message text
set -g message-style bg='#44475a',fg='#8be9fd'
set -g status-style bg='#44475a',fg='#bd93f9'

# Status left (prefix indicator + zoom indicator)
set -g status-left '#[bg=#f8f8f2]#[fg=#282a36]#{?client_prefix,#[bg=#ff79c6],} ☽︎☾ '
set -ga status-left '#[bg=#44475a]#[fg=#ff79c6] #{?window_zoomed_flag, ↕  ,   }'

# Window status
set-window-option -g window-status-style fg='#bd93f9',bg=default
set-window-option -g window-status-current-style fg='#ff79c6',bg='#282a36'
set -g window-status-current-format "#[fg=#44475a]#[bg=#bd93f9]#[fg=#f8f8f2]#[bg=#bd93f9] #I #W #[fg=#bd93f9]#[bg=#44475a]"
set -g window-status-format "#[fg=#f8f8f2]#[bg=#44475a]#I #W #[fg=#44475a] "

# Status right (simplified - remove tmux-mem-cpu-load dependency)
set -g status-right '#[fg=#ff79c6,bg=#44475a]#[fg=#44475a,bg=#ff79c6] #H '
set -ga status-right '#[fg=#bd93f9,bg=#ff79c6]#[fg=#f8f8f2,bg=#bd93f9] %a %H:%M:%S #[fg=#6272a4]%Y-%m-%d '

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity on

# Disable assume-paste-time
set-option -g assume-paste-time 0

# ------------------------------
# Plugins (TPM)
# ------------------------------
# To install plugins:
#   1) Add plugin below
#   2) Prefix + I to install
# To update: Prefix + U
# To remove: Remove line + Prefix + Alt + U

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
# Fingers disabled by default - enable if needed
# set -g @plugin 'Morantron/tmux-fingers'
# set -g @fingers-key F

# Run TPM
run '~/.tmux/plugins/tpm/tpm'

# ------------------------------
# Tips
# ------------------------------
# prefix w       - list sessions/windows
# prefix d       - detach
# prefix :       - respawn-pane -k  (restore dead pane)
# tmux ls        - list sessions
# tmux a -t NAME - attach to session
